!function(a){var b=new Array,c=new Array;a.fn.addTag=function(d,e){var e=jQuery.extend({focus:!1,callback:!0},e);return this.each(function(){id=a(this).attr("id");var f=a(this).val().split(b[id]);if(""==f[0]&&(f=new Array),d=jQuery.trim(d),skipTag=e.unique?a(f).tagExist(d):!1,""!=d&&1!=skipTag){if(a("<span>").addClass("tag").append(a("<span>").text(d).append("&nbsp;&nbsp;"),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+id).removeTag(escape(d))})).insertBefore("#"+id+"_addTag"),f.push(d),a("#"+id+"_tag").val(""),e.focus?a("#"+id+"_tag").focus():a("#"+id+"_tag").blur(),e.callback&&c[id]&&c[id].onAddTag){var g=c[id].onAddTag;g(d)}if(c[id]&&c[id].onChange){var h=f.length,g=c[id].onChange;g(a(this),f[h])}}a.fn.tagsInput.updateTagsField(this,f)}),!1},a.fn.removeTag=function(d){return d=unescape(d),this.each(function(){id=a(this).attr("id");var e=a(this).val().split(b[id]);for(a("#"+id+"_tagsinput .tag").remove(),str="",i=0;i<e.length;i++)e[i]!=d&&(str=str+b[id]+e[i]);if(a.fn.tagsInput.importTags(this,str),c[id]&&c[id].onRemoveTag){var f=c[id].onRemoveTag;f(d)}}),!1},a.fn.tagExist=function(b){return-1==jQuery.inArray(b,a(this))?!1:!0},a.fn.importTags=function(b){a("#"+id+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)},a.fn.tagsInput=function(e){var f=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666"},e);return this.each(function(){f.hide&&a(this).hide(),id=a(this).attr("id"),data=jQuery.extend({pid:id,real_input:"#"+id,holder:"#"+id+"_tagsinput",input_wrapper:"#"+id+"_addTag",fake_input:"#"+id+"_tag"},f),b[id]=data.delimiter,(f.onAddTag||f.onRemoveTag||f.onChange)&&(c[id]=new Array,c[id].onAddTag=f.onAddTag,c[id].onRemoveTag=f.onRemoveTag,c[id].onChange=f.onChange);var e='<div id="'+id+'_tagsinput" class="tagsinput"><div id="'+id+'_addTag">';if(f.interactive&&(e=e+'<input id="'+id+'_tag" value="" data-default="'+f.defaultText+'" />'),e+='</div><div class="tags_clear"></div></div>',a(e).insertAfter(this),a(data.holder).css("width",f.width),a(data.holder).css("height",f.height),""!=a(data.real_input).val()&&a.fn.tagsInput.importTags(a(data.real_input),a(data.real_input).val()),f.interactive){if(a(data.fake_input).val(a(data.fake_input).attr("data-default")),a(data.fake_input).css("color",f.placeholderColor),a(data.holder).bind("click",data,function(b){a(b.data.fake_input).focus()}),a(data.fake_input).bind("focus",data,function(b){a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")&&a(b.data.fake_input).val(""),a(b.data.fake_input).css("color","#000000")}),void 0!=f.autocomplete_url){autocomplete_options={source:f.autocomplete_url};for(attrname in f.autocomplete)autocomplete_options[attrname]=f.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(data.fake_input).autocomplete(f.autocomplete_url,f.autocomplete),a(data.fake_input).bind("result",data,function(b,c){c&&(d=c+"",a(b.data.real_input).addTag(d,{focus:!0,unique:f.unique}))})):void 0!==jQuery.ui.autocomplete&&(a(data.fake_input).autocomplete(autocomplete_options),a(data.fake_input).bind("autocompleteselect",data,function(b,c){return a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:f.unique}),!1}))}else a(data.fake_input).bind("blur",data,function(b){var c=a(this).attr("data-default");return""!=a(b.data.fake_input).val()&&a(b.data.fake_input).val()!=c?b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:f.unique}):(a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default")),a(b.data.fake_input).css("color",f.placeholderColor)),!1});a(data.fake_input).bind("keypress",data,function(b){return b.which==b.data.delimiter.charCodeAt(0)||13==b.which?(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)&&a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:f.unique}),!1):void 0}),data.removeWithBackspace&&a(data.fake_input).bind("keydown",function(b){if(8==b.keyCode&&""==a(this).val()){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last").text(),d=a(this).attr("id").replace(/_tag$/,"");c=c.replace(/[\s]+x$/,""),a("#"+d).removeTag(escape(c)),a(this).trigger("focus")}}),a(data.fake_input).blur()}return!1}),this},a.fn.tagsInput.updateTagsField=function(c,d){id=a(c).attr("id"),a(c).val(d.join(b[id]))},a.fn.tagsInput.importTags=function(d,e){a(d).val(""),id=a(d).attr("id");var f=e.split(b[id]);for(i=0;i<f.length;i++)a(d).addTag(f[i],{focus:!1,callback:!1});if(c[id]&&c[id].onChange){var g=c[id].onChange;g(d,f[i])}}}(jQuery);