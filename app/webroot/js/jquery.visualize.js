!function(a){a.fn.visualize=function(b,c){return a(this).each(function(){function d(){var b=e.colors,c=e.textColors,d={dataGroups:function(){var d=[];if("x"==e.parseDirection)f.find("tr:gt(0)").filter(e.rowFilter).each(function(f){d[f]={},d[f].points=[],d[f].color=b[f],c[f]&&(d[f].textColor=c[f]),a(this).find("td").filter(e.colFilter).each(function(){d[f].points.push(parseFloat(a(this).text()))})});else for(var g=f.find("tr:eq(1) td").filter(e.colFilter).size(),h=0;g>h;h++)d[h]={},d[h].points=[],d[h].color=b[h],c[h]&&(d[h].textColor=c[h]),f.find("tr:gt(0)").filter(e.rowFilter).each(function(){d[h].points.push(1*a(this).find("td").filter(e.colFilter).eq(h).text())});return d},allData:function(){var b=[];return a(this.dataGroups()).each(function(){b.push(this.points)}),b},dataSum:function(){var b=0,c=this.allData().join(",").split(",");return a(c).each(function(){b+=parseFloat(this)}),b},topValue:function(){var b=0,c=this.allData().join(",").split(",");return a(c).each(function(){parseFloat(this,10)>b&&(b=parseFloat(this))}),b},bottomValue:function(){var b=0,c=this.allData().join(",").split(",");return a(c).each(function(){b>this&&(b=parseFloat(this))}),b},memberTotals:function(){var b=[],c=this.dataGroups();return a(c).each(function(d){var e=0;a(c[d].points).each(function(a){e+=c[d].points[a]}),b.push(e)}),b},yTotals:function(){for(var b=[],c=this.dataGroups(),d=this.xLabels().length,e=0;d>e;e++){b[e]=[];var f=0;a(c).each(function(){b[e].push(this.points[e])}),b[e].join(",").split(","),a(b[e]).each(function(){f+=parseFloat(this)}),b[e]=f}return b},topYtotal:function(){var b=0,c=this.yTotals().join(",").split(",");return a(c).each(function(){parseFloat(this,10)>b&&(b=parseFloat(this))}),b},totalYRange:function(){return this.topValue()-this.bottomValue()},xLabels:function(){var b=[];return"x"==e.parseDirection?f.find("tr:eq(0) th").filter(e.colFilter).each(function(){b.push(a(this).html())}):f.find("tr:gt(0) th").filter(e.rowFilter).each(function(){b.push(a(this).html())}),b},yLabels:function(){var a=[];a.push(p);for(var b=Math.round(e.height/e.yLabelInterval),c=Math.ceil(r/b)||1;a[a.length-1]<o-c;)a.push(a[a.length-1]+c);return a.push(o),a}};return d}var e=a.extend({type:"bar",width:a(this).width(),height:"250px",appendTitle:!0,title:null,appendKey:!0,rowFilter:" ",colFilter:" ",colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],textColors:[],parseDirection:"x",pieMargin:20,pieLabelsAsPercent:!0,pieLabelPos:"inside",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30},b);e.width=parseFloat(e.width),e.height=parseFloat(e.height);var f=a(this),g={pie:function(){k.addClass("visualize-pie"),"outside"==e.pieLabelPos&&k.addClass("visualize-pie-outside");var b=Math.round(i.width()/2),c=Math.round(i.height()/2),d=c-e.pieMargin,f=0,g=a('<ul class="visualize-labels"></ul>').insertAfter(i);a.each(q,function(h){var i=0>=this||isNaN(this)?0:this/n;y.beginPath(),y.moveTo(b,c),y.arc(b,c,d,f*Math.PI*2-.5*Math.PI,(f+i)*Math.PI*2-.5*Math.PI,!1),y.lineTo(b,c),y.closePath(),y.fillStyle=m[h].color,y.fill();var j=f+i/2,k="inside"==e.pieLabelPos?d/1.5:d+d/5,l=Math.round(b+Math.sin(j*Math.PI*2)*k),o=Math.round(c-Math.cos(j*Math.PI*2)*k),p=l>b?"right":"left",q=o>c?"bottom":"top",r=parseFloat((100*i).toFixed(2));if(r){var s=e.pieLabelsAsPercent?r+"%":this,t=a('<span class="visualize-label">'+s+"</span>").css(p,0).css(q,0);if(t){a('<li class="visualize-label-pos"></li>').appendTo(g).css({left:l,top:o}).append(t)}t.css("font-size",d/8).css("margin-"+p,-t.width()/2).css("margin-"+q,-t.outerHeight()/2),m[h].textColor&&t.css("color",m[h].textColor)}f+=i})},line:function(b){b?k.addClass("visualize-area"):k.addClass("visualize-line");var c=i.width()/(t.length-1),d=a('<ul class="visualize-labels-x"></ul>').width(i.width()).height(i.height()).insertBefore(i);a.each(t,function(b){var e=a("<li><span>"+this+"</span></li>").prepend('<span class="line" />').css("left",c*b).appendTo(d),f=e.find("span:not(.line)"),g=f.width()/-2;0==b?g=0:b==t.length-1&&(g=-f.width()),f.css("margin-left",g).addClass("label")});var f=i.height()/r,g=i.height()/(u.length-1),h=a('<ul class="visualize-labels-y"></ul>').width(i.width()).height(i.height()).insertBefore(i);a.each(u,function(b){var c=a("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",g*b).prependTo(h),d=c.find("span:not(.line)"),e=d.height()/-2;0==b?e=-d.height():b==u.length-1&&(e=0),d.css("margin-top",e).addClass("label")}),y.translate(0,s),a.each(m,function(){y.beginPath(),y.lineWidth=e.lineWeight,y.lineJoin="round";var d=this.points,g=0;y.moveTo(0,-(d[0]*f)),a.each(d,function(){y.lineTo(g,-(this*f)),g+=c}),y.strokeStyle=this.color,y.stroke(),b?(y.lineTo(g,0),y.lineTo(0,0),y.closePath(),y.fillStyle=this.color,y.globalAlpha=.3,y.fill(),y.globalAlpha=1):y.closePath()})},area:function(){g.line(!0)},bar:function(){k.addClass("visualize-bar");var b=i.width()/t.length,c=a('<ul class="visualize-labels-x"></ul>').width(i.width()).height(i.height()).insertBefore(i);a.each(t,function(d){var e=a('<li><span class="label">'+this+"</span></li>").prepend('<span class="line" />').css("left",b*d).width(b).appendTo(c),f=e.find("span.label");f.addClass("label")});var d=i.height()/r,f=i.height()/(u.length-1),g=a('<ul class="visualize-labels-y"></ul>').width(i.width()).height(i.height()).insertBefore(i);a.each(u,function(b){var c=a("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",f*b).prependTo(g),d=c.find("span:not(.line)"),e=d.height()/-2;0==b?e=-d.height():b==u.length-1&&(e=0),d.css("margin-top",e).addClass("label")}),y.translate(0,s);for(var h=0;h<m.length;h++){y.beginPath();var j=(b-2*e.barGroupMargin)/m.length,l=j-2*e.barMargin;y.lineWidth=l;for(var n=m[h].points,o=0,p=0;p<n.length;p++){var q=o-e.barGroupMargin+h*j+j/2;q+=2*e.barGroupMargin,y.moveTo(q,0),y.lineTo(q,Math.round(-n[p]*d)),o+=b}y.strokeStyle=m[h].color,y.stroke(),y.closePath()}}},h=document.createElement("canvas");h.setAttribute("height",e.height),h.setAttribute("width",e.width);var i=a(h),j=e.title||f.find("caption").text(),k=(c||a('<div class="visualize" role="img" aria-label="Chart representing data from the table: '+j+'" />')).height(e.height).width(e.width).append(i),l=d(),m=l.dataGroups(),n=(l.allData(),l.dataSum()),o=l.topValue(),p=l.bottomValue(),q=l.memberTotals(),r=l.totalYRange(),s=e.height*(o/r),t=l.xLabels(),u=l.yLabels();if(e.appendTitle||e.appendKey)var v=a('<div class="visualize-info"></div>').appendTo(k);if(e.appendTitle&&a('<div class="visualize-title">'+j+"</div>").appendTo(v),e.appendKey){var w,x=a('<ul class="visualize-key"></ul>');w="x"==e.parseDirection?f.find("tr:gt(0) th").filter(e.rowFilter):f.find("tr:eq(0) th").filter(e.colFilter),w.each(function(b){a('<li><span class="visualize-key-color" style="background: '+m[b].color+'"></span><span class="visualize-key-label">'+a(this).text()+"</span></li>").appendTo(x)}),x.appendTo(v)}c||k.insertAfter(this),"undefined"!=typeof G_vmlCanvasManager&&(G_vmlCanvasManager.init(),G_vmlCanvasManager.initElement(i[0]));var y=i[0].getContext("2d");g[e.type](),a(".visualize-line li:first-child span.line, .visualize-line li:last-child span.line, .visualize-area li:first-child span.line, .visualize-area li:last-child span.line, .visualize-bar li:first-child span.line,.visualize-bar .visualize-labels-y li:last-child span.line").css("border","none"),c||k.bind("visualizeRefresh",function(){f.visualize(e,a(this).empty())})}).next()}}(jQuery);